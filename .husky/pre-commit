#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

SCRIPT_DIR="$(dirname -- "$0")"
FRONTEND_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"

if [ -f "$FRONTEND_DIR/package.json" ] && [ -f "$FRONTEND_DIR/web/vite.config.ts" ]; then
  cd "$FRONTEND_DIR" || exit 1
else
  if [ -d "mindful-web-frontend" ] && [ -f "mindful-web-frontend/package.json" ]; then
    cd "mindful-web-frontend" || exit 1
  else
    echo "‚ùå Error: Cannot find frontend directory"
    exit 1
  fi
fi

echo ""
echo "=========================================="
echo "üîç PRE-COMMIT CHECKS - FRONTEND"
echo "=========================================="
echo ""

echo "üîç Running linter..."
npm run lint:fix

LINT_EXIT_CODE=$?
if [ $LINT_EXIT_CODE -ne 0 ]; then
  echo ""
  echo "=========================================="
  echo "‚ùå LINTER FAILED! COMMIT ABORTED."
  echo "=========================================="
  echo ""
  exit $LINT_EXIT_CODE
fi

echo ""
echo "üîç Running type check..."
npm run type-check

TYPECHECK_EXIT_CODE=$?
if [ $TYPECHECK_EXIT_CODE -ne 0 ]; then
  echo ""
  echo "=========================================="
  echo "‚ùå TYPE CHECK FAILED! COMMIT ABORTED."
  echo "=========================================="
  echo ""
  exit $TYPECHECK_EXIT_CODE
fi

echo ""
echo "üß™ Running tests..."
npm test

TEST_EXIT_CODE=$?
if [ $TEST_EXIT_CODE -ne 0 ]; then
  echo ""
  echo "=========================================="
  echo "‚ùå TESTS FAILED! COMMIT ABORTED."
  echo "=========================================="
  echo ""
  exit $TEST_EXIT_CODE
fi

echo ""
echo "=========================================="
echo "‚úÖ ALL CHECKS PASSED!"
echo "=========================================="
echo ""